{"version":3,"file":"index-k4olhZ62.js","sources":["../../../../components/search/SearchResults.vue","../../../../pages/search/index.vue"],"sourcesContent":["<template>\n  <div class=\"listing\">\n    <div\n      v-if=\"title\"\n      class=\"listing__head\">\n      <h2\n        v-if=\"title\"\n        class=\"listing__title\">\n        {{ title }}\n      </h2>\n    </div>\n\n    <div class=\"listing__items\">\n      <Card\n        v-for=\"item in items.results\"\n        :key=\"`card-${item.id}`\"\n        :item=\"item\" />\n    </div>\n\n    <div\n      v-if=\"items.page < items.total_pages\"\n      class=\"listing__nav\">\n      <div v-if=\"loading\">\n        <!-- eslint-disable-next-line -->\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"44\" height=\"44\" viewBox=\"0 0 44 44\" stroke=\"#2196f3\"><g fill=\"none\" fill-rule=\"evenodd\" stroke-width=\"2\"><circle cx=\"22\" cy=\"22\" r=\"1\"><animate attributeName=\"r\" begin=\"0s\" dur=\"1.8s\" values=\"1; 20\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.165, 0.84, 0.44, 1\" repeatCount=\"indefinite\"/><animate attributeName=\"stroke-opacity\" begin=\"0s\" dur=\"1.8s\" values=\"1; 0\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.3, 0.61, 0.355, 1\" repeatCount=\"indefinite\"/></circle><circle cx=\"22\" cy=\"22\" r=\"1\"><animate attributeName=\"r\" begin=\"-0.9s\" dur=\"1.8s\" values=\"1; 20\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.165, 0.84, 0.44, 1\" repeatCount=\"indefinite\"/><animate attributeName=\"stroke-opacity\" begin=\"-0.9s\" dur=\"1.8s\" values=\"1; 0\" calcMode=\"spline\" keyTimes=\"0; 1\" keySplines=\"0.3, 0.61, 0.355, 1\" repeatCount=\"indefinite\"/></circle></g></svg>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { debounce } from '~/mixins/Functions';\nimport Card from '~/components/Card';\n\nexport default {\n  components: {\n    Card,\n  },\n\n  props: {\n    title: {\n      type: String,\n      required: false,\n      default: '',\n    },\n\n    items: {\n      type: Object,\n      required: true,\n    },\n\n    loading: {\n      type: Boolean,\n      required: false,\n      default: false,\n    },\n  },\n\n  mounted () {\n    window.addEventListener('scroll', this.getScrollPosition);\n  },\n\n  beforeDestroy () {\n    window.removeEventListener('scroll', this.getScrollPosition);\n  },\n\n  methods: {\n    getScrollPosition: debounce(function () {\n      if (this.items.page < this.items.total_pages) {\n        const bottomOfWindow = (window.innerHeight + window.pageYOffset) >= document.body.offsetHeight - 600;\n        if (bottomOfWindow && !this.loading) this.loadMore();\n      } else {\n        // remove scroll event, no more pages to load\n        window.removeEventListener('scroll', this.getScrollPosition);\n      }\n    }, 50),\n\n    loadMore () {\n      this.$emit('loadMore');\n    },\n  },\n};\n</script>\n","<template>\n\t<main class=\"main\">\n\t\t<SearchResults\n\t\t\tv-if=\"items && items.results.length\"\n\t\t\t:title=\"title\"\n\t\t\t:items=\"items\"\n\t\t\t:loading=\"loading\"\n\t\t\t@loadMore=\"loadMore\"\n\t\t/>\n\t</main>\n</template>\n\n<script>\nimport { useRoute } from \"vue-router\";\nimport { useBackendStore } from \"~/store/backend\";\nimport SearchResults from \"~/components/search/SearchResults\";\nlet fromPage = \"/\";\n\nexport default {\n\tcomponents: {\n\t\tSearchResults,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloading: false,\n\t\t};\n\t},\n\n\thead() {\n\t\treturn {\n\t\t\ttitle: \"Search\",\n\t\t\tmeta: [\n\t\t\t\t{ hid: \"og:title\", property: \"og:title\", content: \"Search\" },\n\t\t\t\t{\n\t\t\t\t\thid: \"og:url\",\n\t\t\t\t\tproperty: \"og:url\",\n\t\t\t\t\tcontent: `${process.env.FRONTEND_URL}${this.$route.path}`,\n\t\t\t\t},\n\t\t\t],\n\t\t\tbodyAttrs: {\n\t\t\t\tclass: \"page page-search\",\n\t\t\t},\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tquery() {\n\t\t\treturn this.$route.query.q ? this.$route.query.q : \"\";\n\t\t},\n\n\t\ttitle() {\n\t\t\treturn this.query ? `Results For: ${this.query}` : \"\";\n\t\t},\n\t},\n\n\tsetup() {\n\t\tconst store = useBackendStore();\n        const route = useRoute();\n\t\tconst items = ref(null);\n\n\t\tonMounted(async () => {\n\t\t\ttry {\n                if (route.query.q) {\n                    const itemData = await store.search({query:  route.query.q, page: 1});\n                    items.value = itemData.data;\n                } else {\n                    redirect(\"/\");\n                }\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error({ status: error.code, error: error.message });\n\t\t\t}\n\t\t});\n\n\t\treturn { items };\n\t},\n\n\tbeforeRouteEnter(to, from, next) {\n\t\tfromPage = from.path;\n\t\tnext();\n\t},\n\n\tbeforeRouteUpdate(to, from, next) {\n\t\tnext();\n\t\tthis.getResults();\n\t},\n\n\tbeforeRouteLeave(to, from, next) {\n\t\tconst search = document.getElementById(\"search\");\n\n\t\tnext();\n\n\t\tif (search && search.value.length) {\n\t\t\tthis.$store.commit(\"search/closeSearch\");\n\t\t}\n\t},\n\n\tmethods: {\n\t\tasync getResults() {\n\t\t\t// if no search query\n\t\t\tif (!this.query.length) {\n\t\t\t\tthis.items = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// trigger ajax call;\n\t\t\tconst response = await useBackendStore().search({query: this.query});\n\n\t\t\t// if no results, do nothing\n\t\t\tif (!response.data.total_results) {\n\t\t\t\tthis.items = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update the items\n\t\t\tthis.items = response.data;\n\t\t},\n\n\t\tloadMore() {\n\t\t\tthis.loading = true;\n\n\t\t\tuseBackendStore().search({query: this.query, page: this.items.page + 1})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.items.results = this.items.results.concat(response.data.results);\n\t\t\t\t\tthis.items.page = response.data.page;\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t});\n\t\t},\n\t},\n};\n</script>\n\n<style lang=\"scss\">\n@import \"~/assets/css/utilities/_variables.scss\";\n\n.page-search .main {\n\tpadding-top: 6rem;\n\n\t@media (min-width: $breakpoint-large) {\n\t\tpadding-top: 8rem;\n\t}\n}\n</style>\n"],"names":["_sfc_main","Card","_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_ssrRenderList","_ssrRenderComponent","SearchResults"],"mappings":"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"}